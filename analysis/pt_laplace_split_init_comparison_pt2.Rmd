---
title: "pt_laplace_split_init_comparison_pt2"
author: "Annie Xie"
date: "2025-09-05"
output: 
  workflowr::wflow_html:
    code_folding: hide
editor_options:
  chunk_output_type: console
---

# Introduction
In this analysis, we include visualizations for one simulation from the DSC. In this example, all of the EB methods used the generalized binary prior.

```{r, message = FALSE, warning = FALSE}
library(dplyr)
library(ggplot2)
library(pheatmap)
```

```{r}
source('code/visualization_functions.R')
```

```{r}
data_files <- list.files(path = 'data/adclus_same_init_dsc_ex')
```

```{r}
codesymnmf_files <- grep('codesymnmf', 
                         list.files(path ='data/symnmf_same_init_dsc_ex'),
                         value = TRUE)
```

```{r}
init_files <- list.files(path = 'data/pt_laplace_split_init_ex')
```

# Unbalanced Non-overlapping

This is a heatmap of the true loadings matrix:
```{r}
unbal_nonoverlap_sim_ex <- readRDS('data/group_nonoverlap_2.rds')
L_mat <- unbal_nonoverlap_sim_ex$true_L
plot_heatmap(L_mat, title = 'True Loadings', 
               colors_range = c('gray96','red'),
               brks = seq(0, max(abs(L_mat)), length.out = 50))
```

This is a heatmap of the scaled Gram matrix:
```{r}
cov_mat <- unbal_nonoverlap_sim_ex$data$YYt
plot_heatmap(cov_mat, title = 'Scaled Gram Matrix', 
               colors_range = c('blue','gray96','red'),
               brks = seq(-max(abs(cov_mat)), max(abs(cov_mat)), length.out = 50))
```

## Initialization

```{r}
est <- readRDS(paste0('data/pt_laplace_split_init_ex/', init_files[3]))$init_L
plot_heatmap(est, title = 'Initialization', 
               colors_range = c('gray96','red'),
               brks = seq(0, max(abs(est)), length.out = 50))
```

## Estimates

```{r}
group_nonoverlap_files <- grep('group_nonoverlap', data_files, value = TRUE)
unbal_nonoverlap_files <- grep('2_', group_nonoverlap_files, value = TRUE)
length(unbal_nonoverlap_files)
```

```{r}
#par(mfrow = c(4, 2))
#par(mar = c(4, 4, 2, 1)) 
for (i in unbal_nonoverlap_files){
  #extract method
  method <- sub("^(?:[^_]*_){7}(.*)_.*$", "\\1", i)
  
  est <- readRDS(paste0('data/adclus_same_init_dsc_ex/',i))$est_L
  plot_heatmap(est, title = method, 
               colors_range = c('blue','gray96','red'),
               brks = seq(-max(abs(est)), max(abs(est)), length.out = 50))
}
#par(mfrow = c(1, 1))
```

```{r}
est <- readRDS(paste0('data/symnmf_same_init_dsc_ex/', codesymnmf_files[3]))$est_L
plot_heatmap(est, title = 'codesymnmf', 
               colors_range = c('blue','gray96','red'),
               brks = seq(-max(abs(est)), max(abs(est)), length.out = 50))
```

# Balanced Non-overlapping

This is a heatmap of the true loadings matrix:
```{r}
bal_nonoverlap_sim_ex <- readRDS('data/group_nonoverlap_1.rds')
L_mat <- bal_nonoverlap_sim_ex$true_L
plot_heatmap(L_mat, title = 'True Loadings', 
               colors_range = c('gray96','red'),
               brks = seq(0, max(abs(L_mat)), length.out = 50))
```

This is a heatmap of the scaled Gram matrix:
```{r}
cov_mat <- bal_nonoverlap_sim_ex$data$YYt
plot_heatmap(cov_mat, title = 'Scaled Gram Matrix', 
               colors_range = c('blue','gray96','red'),
               brks = seq(-max(abs(cov_mat)), max(abs(cov_mat)), length.out = 50))
```

## Initialization
```{r}
est <- readRDS(paste0('data/pt_laplace_split_init_ex/', init_files[2]))$init_L
plot_heatmap(est, title = 'Initialization', 
               colors_range = c('gray96','red'),
               brks = seq(0, max(abs(est)), length.out = 50))
```

## Estimates
```{r}
# group_nonoverlap_files <- grep('group_nonoverlap', data_files, value = TRUE)
bal_nonoverlap_files <- grep('group_nonoverlap_1', group_nonoverlap_files, value = TRUE)
length(bal_nonoverlap_files)
```

```{r}
#par(mfrow = c(4, 2))
#par(mar = c(4, 4, 2, 1)) 
for (i in bal_nonoverlap_files){
  #extract method
  method <- sub("^(?:[^_]*_){7}(.*)_.*$", "\\1", i)
  
  est <- readRDS(paste0('data/adclus_same_init_dsc_ex/',i))$est_L
  plot_heatmap(est, title = method, 
               colors_range = c('blue','gray96','red'),
               brks = seq(-max(abs(est)), max(abs(est)), length.out = 50))
}
#par(mfrow = c(1, 1))
```

```{r}
est <- readRDS(paste0('data/symnmf_same_init_dsc_ex/', codesymnmf_files[2]))$est_L
plot_heatmap(est, title = 'codesymnmf', 
               colors_range = c('blue','gray96','red'),
               brks = seq(-max(abs(est)), max(abs(est)), length.out = 50))
```

# Balanced Tree

This is a heatmap of the true loadings matrix:
```{r}
baltree_sim_ex <- readRDS('data/baltree_4pop_1.rds')
L_mat <- baltree_sim_ex$true_L
plot_heatmap(L_mat, title = 'True Loadings', 
               colors_range = c('gray96','red'),
               brks = seq(0, max(abs(L_mat)), length.out = 50))
```

This is a heatmap of the scaled Gram matrix:
```{r}
cov_mat <- baltree_sim_ex$data$YYt
plot_heatmap(cov_mat, title = 'Scaled Gram Matrix', 
               colors_range = c('blue','gray96','red'),
               brks = seq(-max(abs(cov_mat)), max(abs(cov_mat)), length.out = 50))
```

## Initialization
```{r}
est <- readRDS(paste0('data/pt_laplace_split_init_ex/', init_files[1]))$init_L
plot_heatmap(est, title = 'Initialization', 
               colors_range = c('gray96','red'),
               brks = seq(0, max(abs(est)), length.out = 50))
```

## Estimates
```{r}
baltree_files <- grep('baltree_4pop', data_files, value = TRUE)
length(baltree_files)
```

```{r}
#par(mfrow = c(4, 2))
#par(mar = c(4, 4, 2, 1)) 
for (i in baltree_files){
  #extract method
  method <- sub("^(?:[^_]*_){7}(.*)_.*$", "\\1", i)
  
  est <- readRDS(paste0('data/adclus_same_init_dsc_ex/',i))$est_L
  plot_heatmap(est, title = method, 
               colors_range = c('blue','gray96','red'),
               brks = seq(-max(abs(est)), max(abs(est)), length.out = 50))
}
#par(mfrow = c(1, 1))
```

```{r}
est <- readRDS(paste0('data/symnmf_same_init_dsc_ex/', codesymnmf_files[1]))$est_L
plot_heatmap(est, title = 'codesymnmf', 
               colors_range = c('blue','gray96','red'),
               brks = seq(-max(abs(est)), max(abs(est)), length.out = 50))
```

# Sparse Overlapping

This is a heatmap of the true loadings matrix:
```{r}
overlap_sim_ex <- readRDS('data/group_overlap_1.rds')
L_mat <- overlap_sim_ex$true_L
plot_heatmap(L_mat, title = 'True Loadings', 
               colors_range = c('gray96','red'),
               brks = seq(0, max(abs(L_mat)), length.out = 50))
```

This is a heatmap of the scaled Gram matrix:
```{r}
cov_mat <- overlap_sim_ex$data$YYt
plot_heatmap(cov_mat, title = 'Scaled Gram Matrix', 
               colors_range = c('blue','gray96','red'),
               brks = seq(-max(abs(cov_mat)), max(abs(cov_mat)), length.out = 50))
```

## Initialization
```{r}
est <- readRDS(paste0('data/pt_laplace_split_init_ex/', init_files[4]))$init_L
plot_heatmap(est, title = 'Initialization', 
               colors_range = c('gray96','red'),
               brks = seq(0, max(abs(est)), length.out = 50))
```

## Estimates
```{r}
overlap_files <- grep('group_overlap', data_files, value = TRUE)
length(overlap_files)
```

```{r}
#par(mfrow = c(4, 2))
#par(mar = c(4, 4, 2, 1)) 
for (i in overlap_files){
  #extract method
  method <- sub("^(?:[^_]*_){7}(.*)_.*$", "\\1", i)
  
  est <- readRDS(paste0('data/adclus_same_init_dsc_ex/',i))$est_L
  plot_heatmap(est, title = method, 
               colors_range = c('blue','gray96','red'),
               brks = seq(-max(abs(est)), max(abs(est)), length.out = 50))
}
#par(mfrow = c(1, 1))
```

```{r}
est <- readRDS(paste0('data/symnmf_same_init_dsc_ex/', codesymnmf_files[4]))$est_L
plot_heatmap(est, title = 'codesymnmf', 
               colors_range = c('blue','gray96','red'),
               brks = seq(-max(abs(est)), max(abs(est)), length.out = 50))
```

# Unbalanced Tree

This is a heatmap of the true loadings matrix:
```{r}
unbaltree_sim_ex <- readRDS('data/unbaltree_4pop_1.rds')
L_mat <- unbaltree_sim_ex$true_L
plot_heatmap(L_mat, title = 'True Loadings', 
               colors_range = c('gray96','red'),
               brks = seq(0, max(abs(L_mat)), length.out = 50))
```

This is a heatmap of the scaled Gram matrix:
```{r}
cov_mat <- unbaltree_sim_ex$data$YYt
plot_heatmap(cov_mat, title = 'Scaled Gram Matrix', 
               colors_range = c('blue','gray96','red'),
               brks = seq(-max(abs(cov_mat)), max(abs(cov_mat)), length.out = 50))
```

## Initialization
```{r}
est <- readRDS(paste0('data/pt_laplace_split_init_ex/', init_files[5]))$init_L
plot_heatmap(est, title = 'Initialization', 
               colors_range = c('gray96','red'),
               brks = seq(0, max(abs(est)), length.out = 50))
```

## Estimates
```{r}
unbaltree_files <- grep('unbaltree_4pop', data_files, value = TRUE)
length(unbaltree_files)
```

```{r}
#par(mfrow = c(4, 2))
#par(mar = c(4, 4, 2, 1)) 
for (i in unbaltree_files){
  #extract method
  method <- sub("^(?:[^_]*_){7}(.*)_.*$", "\\1", i)
  
  est <- readRDS(paste0('data/adclus_same_init_dsc_ex/',i))$est_L
  plot_heatmap(est, title = method, 
               colors_range = c('blue','gray96','red'),
               brks = seq(-max(abs(est)), max(abs(est)), length.out = 50))
}
#par(mfrow = c(1, 1))
```

```{r}
est <- readRDS(paste0('data/symnmf_same_init_dsc_ex/', codesymnmf_files[5]))$est_L
plot_heatmap(est, title = 'codesymnmf', 
               colors_range = c('blue','gray96','red'),
               brks = seq(-max(abs(est)), max(abs(est)), length.out = 50))
```
