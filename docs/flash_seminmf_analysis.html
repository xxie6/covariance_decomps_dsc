<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Annie Xie" />

<meta name="date" content="2025-09-10" />

<title>flash_seminmf_analysis</title>

<script src="site_libs/header-attrs-2.29/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-6.5.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet" />

<link rel="icon" href="https://github.com/workflowr/workflowr-assets/raw/main/img/reproducible.png">
<!-- Add a small amount of space between sections. -->
<style type="text/css">
div.section {
  padding-top: 12px;
}
</style>



<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">covariance_decomps_dsc</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
<li>
  <a href="license.html">License</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/xxie6/covariance_decomps_dsc">
    <span class="fab fa-github"></span>
     
    Source code
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">flash_seminmf_analysis</h1>
<h4 class="author">Annie Xie</h4>
<h4 class="date">2025-09-10</h4>

</div>


<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-report" data-toggle="collapse" data-target="#workflowr-report">
<span class="glyphicon glyphicon-list" aria-hidden="true"></span>
workflowr <span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span>
</button>
</p>
<div id="workflowr-report" class="collapse">
<ul class="nav nav-tabs">
<li class="active">
<a data-toggle="tab" href="#summary">Summary</a>
</li>
<li>
<a data-toggle="tab" href="#checks"> Checks <span
class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span>
</a>
</li>
<li>
<a data-toggle="tab" href="#versions">Past versions</a>
</li>
</ul>
<div class="tab-content">
<div id="summary" class="tab-pane fade in active">
<p>
<strong>Last updated:</strong> 2025-09-11
</p>
<p>
<strong>Checks:</strong> <span
class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> 7
<span class="glyphicon glyphicon-exclamation-sign text-danger"
aria-hidden="true"></span> 0
</p>
<p>
<strong>Knit directory:</strong> <code>covariance_decomps_dsc/</code>
<span class="glyphicon glyphicon-question-sign" aria-hidden="true"
title="This is the local directory in which the code in this file was executed.">
</span>
</p>
<p>
This reproducible <a href="https://rmarkdown.rstudio.com">R Markdown</a>
analysis was created with <a
  href="https://github.com/workflowr/workflowr">workflowr</a> (version
1.7.1). The <em>Checks</em> tab describes the reproducibility checks
that were applied when the results were created. The <em>Past
versions</em> tab lists the development history.
</p>
<hr>
</div>
<div id="checks" class="tab-pane fade">
<div id="workflowr-checks" class="panel-group">
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRMarkdownfilestronguptodate">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>R Markdown file:</strong> up-to-date
</a>
</p>
</div>
<div id="strongRMarkdownfilestronguptodate"
class="panel-collapse collapse">
<div class="panel-body">
<p>Great! Since the R Markdown file has been committed to the Git
repository, you know the exact version of the code that produced these
results.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongEnvironmentstrongempty">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>Environment:</strong> empty </a>
</p>
</div>
<div id="strongEnvironmentstrongempty" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! The global environment was empty. Objects defined in the
global environment can affect the analysis in your R Markdown file in
unknown ways. For reproduciblity it’s best to always run the code in an
empty environment.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSeedstrongcodesetseed20250203code">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>Seed:</strong>
<code>set.seed(20250203)</code> </a>
</p>
</div>
<div id="strongSeedstrongcodesetseed20250203code"
class="panel-collapse collapse">
<div class="panel-body">
<p>The command <code>set.seed(20250203)</code> was run prior to running
the code in the R Markdown file. Setting a seed ensures that any results
that rely on randomness, e.g. subsampling or permutations, are
reproducible.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSessioninformationstrongrecorded">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>Session information:</strong>
recorded </a>
</p>
</div>
<div id="strongSessioninformationstrongrecorded"
class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Recording the operating system, R version, and package
versions is critical for reproducibility.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongCachestrongnone">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>Cache:</strong> none </a>
</p>
</div>
<div id="strongCachestrongnone" class="panel-collapse collapse">
<div class="panel-body">
<p>Nice! There were no cached chunks for this analysis, so you can be
confident that you successfully produced the results during this
run.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongFilepathsstrongrelative">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>File paths:</strong> relative </a>
</p>
</div>
<div id="strongFilepathsstrongrelative" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Using relative paths to the files within your workflowr
project makes it easier to run your code on other machines.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRepositoryversionstrongahrefhttpsgithubcomxxie6covariancedecompsdsctree57d5f360b6763fe6718a9e140a91f178ab48273ftargetblank57d5f36a">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>Repository version:</strong>
<a href="https://github.com/xxie6/covariance_decomps_dsc/tree/57d5f360b6763fe6718a9e140a91f178ab48273f" target="_blank">57d5f36</a>
</a>
</p>
</div>
<div
id="strongRepositoryversionstrongahrefhttpsgithubcomxxie6covariancedecompsdsctree57d5f360b6763fe6718a9e140a91f178ab48273ftargetblank57d5f36a"
class="panel-collapse collapse">
<div class="panel-body">
<p>
Great! You are using Git for version control. Tracking code development
and connecting the code version to the results is critical for
reproducibility.
</p>
<p>
The results in this page were generated with repository version
<a href="https://github.com/xxie6/covariance_decomps_dsc/tree/57d5f360b6763fe6718a9e140a91f178ab48273f" target="_blank">57d5f36</a>.
See the <em>Past versions</em> tab to see a history of the changes made
to the R Markdown and HTML files.
</p>
<p>
Note that you need to be careful to ensure that all relevant files for
the analysis have been committed to Git prior to generating the results
(you can use <code>wflow_publish</code> or
<code>wflow_git_commit</code>). workflowr only checks the R Markdown
file, but you know if there are other scripts or data files that it
depends on. Below is the status of the Git repository when the results
were generated:
</p>
<pre><code>
Ignored files:
    Ignored:    .DS_Store
    Ignored:    .Rhistory
    Ignored:    data/.DS_Store
    Ignored:    data/adclus_cov_comp_dsc_ex/.DS_Store
    Ignored:    data/adclus_same_init_dsc_ex/.DS_Store
    Ignored:    data/pt_laplace_split_init_ex/.DS_Store

</code></pre>
<p>
Note that any generated files, e.g. HTML, png, CSS, etc., are not
included in this status report because it is ok for generated content to
have uncommitted changes.
</p>
</div>
</div>
</div>
</div>
<hr>
</div>
<div id="versions" class="tab-pane fade">

<p>
These are the previous versions of the repository in which changes were
made to the R Markdown
(<code>analysis/flash_seminmf_analysis.Rmd</code>) and HTML
(<code>docs/flash_seminmf_analysis.html</code>) files. If you’ve
configured a remote Git repository (see <code>?wflow_git_remote</code>),
click on the hyperlinks in the table below to view the files as they
were in that past version.
</p>
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
File
</th>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
<th>
Message
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/xxie6/covariance_decomps_dsc/blob/57d5f360b6763fe6718a9e140a91f178ab48273f/analysis/flash_seminmf_analysis.Rmd" target="_blank">57d5f36</a>
</td>
<td>
Annie Xie
</td>
<td>
2025-09-11
</td>
<td>
Add exploration of flash-semiNMF
</td>
</tr>
</tbody>
</table>
</div>
<hr>
</div>
</div>
</div>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>In this analysis, I am exploring the flash semi-nonnegative matrix
factorization method. We apply flash to the data matrix with the
generalized binary prior over the loadings matrix and the point-Laplace
prior over the factor matrix.</p>
<p>Semi-nonnegative matrix factorization is an alternative approach to
covariance decomposition (and of course, nonnegative matrix
factorization), e.g. there is a paper that suggests using binary
semi-nonnegative matrix factorization for overlapping community
detection. One way to get a semiNMF is to apply flashier with a
non-negative prior over the loadings <span
class="math inline">\(L\)</span> and a point-Laplace prior over <span
class="math inline">\(F\)</span> (I will refer to this as
flash-semiNMF). If the factors are independent, we suspect that
flash-semiNMF could get something that looks like a covariance
decomposition. In addition, we suspect that flash-semiNMF could perform
better if the factors are, in fact, sparse. However, we don’t have any
theory that connects flash-semiNMF with a factorization of the distance
matrix or the covariance matrix. For flash with a non-negative prior
over <span class="math inline">\(L\)</span> and a normal prior over
<span class="math inline">\(F\)</span>, we do have theory which suggests
it is a covariance decomposition. However, the mean-field variational
approximation encourages <span class="math inline">\(L\)</span> to be
orthogonal. So I wonder if flash-semiNMF would also prefer
representations with orthogonal <span
class="math inline">\(L\)</span>.</p>
<p>Furthermore, we have found that some covariance decomposition methods
which work in the covariance space have a tendency to add extra factors.
Our intuition is flash-semiNMF should be better at avoiding extra
factors due to the the sparsity inducing priors on the loadings and
factors.</p>
<pre class="r"><code>library(dplyr)
library(ggplot2)
library(pheatmap)</code></pre>
<pre class="r"><code>source(&#39;code/visualization_functions.R&#39;)</code></pre>
</div>
<div id="prepare-the-dsc-data" class="section level1">
<h1>Prepare the DSC data</h1>
<pre class="r"><code>dscout &lt;- readRDS(&quot;data/dsc_results_df.rds&quot;)
dim(dscout)</code></pre>
<pre><code>[1] 13200    12</code></pre>
<p>In this analysis, I focus on the flash semi-nonnegative matrix
factorization method. In particular, I focus on the variant which uses
backfitting and the generalized binary prior over the loadings. I also
am interested in comparing it to flash with a normal prior on <span
class="math inline">\(F\)</span>.</p>
<pre class="r"><code>dscout &lt;- dscout %&gt;% filter(analyze %in% c(&#39;flash_seminmf&#39;, &#39;flash_normalf&#39;), analyze.backfit == TRUE, analyze.ebnm_fn == &#39;ebnm::ebnm_generalized_binary&#39;)</code></pre>
</div>
<div id="comparing-k-input" class="section level1">
<h1>Comparing K input</h1>
<p>In this section, we compare flash-semiNMF with different inputs for
<code>Kmax</code>.</p>
<div id="crossprod-similarity" class="section level2">
<h2>Crossprod Similarity</h2>
<p>This is the average crossproduct similarity for the method in each
setting:</p>
<pre class="r"><code>dscout %&gt;% filter(score == &#39;crossprod_similarity&#39;, analyze == &#39;flash_seminmf&#39;) %&gt;% group_by(simulate, simulate.pop_sizes, analyze.Kmax_factor) %&gt;% summarise(avg_result = mean(score.result)) %&gt;% arrange(simulate, simulate.pop_sizes, analyze.Kmax_factor)</code></pre>
<pre><code>`summarise()` has grouped output by &#39;simulate&#39;, &#39;simulate.pop_sizes&#39;. You can
override using the `.groups` argument.</code></pre>
<pre><code># A tibble: 10 × 4
# Groups:   simulate, simulate.pop_sizes [5]
   simulate         simulate.pop_sizes analyze.Kmax_factor avg_result
   &lt;chr&gt;            &lt;chr&gt;                            &lt;dbl&gt;      &lt;dbl&gt;
 1 baltree_4pop     rep(40, 4)                           1      0.558
 2 baltree_4pop     rep(40, 4)                           2      0.409
 3 group_nonoverlap c(20,50,30,60)                       1      0.973
 4 group_nonoverlap c(20,50,30,60)                       2      0.896
 5 group_nonoverlap rep(40, 4)                           1      0.893
 6 group_nonoverlap rep(40, 4)                           2      0.944
 7 group_overlap    &lt;NA&gt;                                 1      0.897
 8 group_overlap    &lt;NA&gt;                                 2      0.839
 9 unbaltree_4pop   rep(40, 4)                           1      0.655
10 unbaltree_4pop   rep(40, 4)                           2      0.655</code></pre>
<p>The method performs best in the non-overlapping settings.
Interestingly, there are some settings in which the method performs
worse with larger <span class="math inline">\(K\)</span>. Taking a
closer look at the scores, I found that for larger <span
class="math inline">\(K\)</span>, there were simulations where the
method returned a zero matrix for the loadings estimate. In the other
simulations, the performance is comparable. As a result, the average
crossproduct similarity for larger <span
class="math inline">\(K\)</span> is lower.</p>
</div>
<div id="proportions" class="section level2">
<h2>Proportions</h2>
<p>In this section, we consider two metrics: 1) the proportion of the
estimated factors which are highly similar to a true factor 2) the
proportion of true factors that are highly similar to at least one
estimated factor. Note that in the first proportion, it is possible that
multiple estimates are similar to the same true factor – perhaps to
avoid this, the threshold for “highly similar” should be really high,
e.g. 0.99.</p>
<pre class="r"><code>dscout %&gt;% filter(score == &#39;prop_true_high_cos_sim&#39;, score.threshold == 0.99, analyze == &#39;flash_seminmf&#39;) %&gt;% group_by(simulate, simulate.pop_sizes, score, analyze.Kmax_factor) %&gt;% summarise(avg_result = mean(score.result)) %&gt;% arrange(simulate, simulate.pop_sizes, score, analyze.Kmax_factor)</code></pre>
<pre><code>`summarise()` has grouped output by &#39;simulate&#39;, &#39;simulate.pop_sizes&#39;, &#39;score&#39;.
You can override using the `.groups` argument.</code></pre>
<pre><code># A tibble: 10 × 5
# Groups:   simulate, simulate.pop_sizes, score [5]
   simulate         simulate.pop_sizes score      analyze.Kmax_factor avg_result
   &lt;chr&gt;            &lt;chr&gt;              &lt;chr&gt;                    &lt;dbl&gt;      &lt;dbl&gt;
 1 baltree_4pop     rep(40, 4)         prop_true…                   1      0.4  
 2 baltree_4pop     rep(40, 4)         prop_true…                   2      0.3  
 3 group_nonoverlap c(20,50,30,60)     prop_true…                   1      0.9  
 4 group_nonoverlap c(20,50,30,60)     prop_true…                   2      0.875
 5 group_nonoverlap rep(40, 4)         prop_true…                   1      0.6  
 6 group_nonoverlap rep(40, 4)         prop_true…                   2      0.8  
 7 group_overlap    &lt;NA&gt;               prop_true…                   1      0.56 
 8 group_overlap    &lt;NA&gt;               prop_true…                   2      0.56 
 9 unbaltree_4pop   rep(40, 4)         prop_true…                   1      0.557
10 unbaltree_4pop   rep(40, 4)         prop_true…                   2      0.557</code></pre>
<p>The proportion of true factors recovered paints a similar story.</p>
<pre class="r"><code>dscout %&gt;% filter(score == &#39;prop_est_high_cos_sim&#39;, score.threshold == 0.99, analyze == &#39;flash_seminmf&#39;) %&gt;% group_by(simulate, simulate.pop_sizes, score, analyze.Kmax_factor) %&gt;% summarise(avg_result = mean(score.result)) %&gt;% arrange(simulate, simulate.pop_sizes, score, analyze.Kmax_factor)</code></pre>
<pre><code>`summarise()` has grouped output by &#39;simulate&#39;, &#39;simulate.pop_sizes&#39;, &#39;score&#39;.
You can override using the `.groups` argument.</code></pre>
<pre><code># A tibble: 10 × 5
# Groups:   simulate, simulate.pop_sizes, score [5]
   simulate         simulate.pop_sizes score      analyze.Kmax_factor avg_result
   &lt;chr&gt;            &lt;chr&gt;              &lt;chr&gt;                    &lt;dbl&gt;      &lt;dbl&gt;
 1 baltree_4pop     rep(40, 4)         prop_est_…                   1      0.65 
 2 baltree_4pop     rep(40, 4)         prop_est_…                   2      0.46 
 3 group_nonoverlap c(20,50,30,60)     prop_est_…                   1      0.9  
 4 group_nonoverlap c(20,50,30,60)     prop_est_…                   2      0.855
 5 group_nonoverlap rep(40, 4)         prop_est_…                   1      0.6  
 6 group_nonoverlap rep(40, 4)         prop_est_…                   2      0.8  
 7 group_overlap    &lt;NA&gt;               prop_est_…                   1      0.569
 8 group_overlap    &lt;NA&gt;               prop_est_…                   2      0.525
 9 unbaltree_4pop   rep(40, 4)         prop_est_…                   1      0.84 
10 unbaltree_4pop   rep(40, 4)         prop_est_…                   2      0.84 </code></pre>
<p>For most of the methods, the proportion of estimated factors which
are highly similar to a true factor does not change that much between
the two <code>Kmax</code> inputs. The setting with the most significant
change is the balanced tree setting, where the proportion drops from
0.65 to 0.46 with larger <span class="math inline">\(K\)</span>.</p>
</div>
</div>
<div id="comparing-seminmf-methods" class="section level1">
<h1>Comparing semiNMF Methods</h1>
<p>In this section, I compare flash with (generalized binary prior on
<span class="math inline">\(L\)</span> and) normal prior on <span
class="math inline">\(F\)</span> with flash with point-Laplace prior on
<span class="math inline">\(F\)</span>. I am interested in the method’s
ability to avoid redundant or extraneous factors. So I will focus on the
setting where the methods are given double the correct number of
components.</p>
<div id="crossprod-similarity-1" class="section level2">
<h2>Crossprod Similarity</h2>
<p>This is the average crossproduct similarity for the method in each
setting:</p>
<pre class="r"><code>dscout %&gt;% filter(score == &#39;crossprod_similarity&#39;, analyze.Kmax_factor == 2) %&gt;% group_by(simulate, simulate.pop_sizes, analyze) %&gt;% summarise(avg_result = mean(score.result)) %&gt;% arrange(simulate, simulate.pop_sizes, analyze)</code></pre>
<pre><code>`summarise()` has grouped output by &#39;simulate&#39;, &#39;simulate.pop_sizes&#39;. You can
override using the `.groups` argument.</code></pre>
<pre><code># A tibble: 10 × 4
# Groups:   simulate, simulate.pop_sizes [5]
   simulate         simulate.pop_sizes analyze       avg_result
   &lt;chr&gt;            &lt;chr&gt;              &lt;chr&gt;              &lt;dbl&gt;
 1 baltree_4pop     rep(40, 4)         flash_normalf      0.834
 2 baltree_4pop     rep(40, 4)         flash_seminmf      0.409
 3 group_nonoverlap c(20,50,30,60)     flash_normalf      0.973
 4 group_nonoverlap c(20,50,30,60)     flash_seminmf      0.896
 5 group_nonoverlap rep(40, 4)         flash_normalf      0.946
 6 group_nonoverlap rep(40, 4)         flash_seminmf      0.944
 7 group_overlap    &lt;NA&gt;               flash_normalf      0.932
 8 group_overlap    &lt;NA&gt;               flash_seminmf      0.839
 9 unbaltree_4pop   rep(40, 4)         flash_normalf      0.888
10 unbaltree_4pop   rep(40, 4)         flash_seminmf      0.655</code></pre>
<p>In all of the settings, flash with a normal prior on <span
class="math inline">\(F\)</span> performs better. Recall, this method
does not penalize extra factors.</p>
</div>
<div id="proportions-1" class="section level2">
<h2>Proportions</h2>
<p>In this section, we consider two metrics: 1) the proportion of the
estimated factors which are highly similar to a true factor 2) the
proportion of true factors that are highly similar to at least one
estimated factor. Note that in the first proportion, it is possible that
multiple estimates are similar to the same true factor – perhaps to
avoid this, the threshold for “highly similar” should be really high,
e.g. 0.99.</p>
<pre class="r"><code>dscout %&gt;% filter(score == &#39;prop_true_high_cos_sim&#39;, score.threshold == 0.99, analyze.Kmax_factor == 2) %&gt;% group_by(simulate, simulate.pop_sizes, score, analyze) %&gt;% summarise(avg_result = mean(score.result)) %&gt;% arrange(simulate, simulate.pop_sizes, score, analyze)</code></pre>
<pre><code>`summarise()` has grouped output by &#39;simulate&#39;, &#39;simulate.pop_sizes&#39;, &#39;score&#39;.
You can override using the `.groups` argument.</code></pre>
<pre><code># A tibble: 10 × 5
# Groups:   simulate, simulate.pop_sizes, score [5]
   simulate         simulate.pop_sizes score                  analyze avg_result
   &lt;chr&gt;            &lt;chr&gt;              &lt;chr&gt;                  &lt;chr&gt;        &lt;dbl&gt;
 1 baltree_4pop     rep(40, 4)         prop_true_high_cos_sim flash_…      0.5  
 2 baltree_4pop     rep(40, 4)         prop_true_high_cos_sim flash_…      0.3  
 3 group_nonoverlap c(20,50,30,60)     prop_true_high_cos_sim flash_…      0.9  
 4 group_nonoverlap c(20,50,30,60)     prop_true_high_cos_sim flash_…      0.875
 5 group_nonoverlap rep(40, 4)         prop_true_high_cos_sim flash_…      0.8  
 6 group_nonoverlap rep(40, 4)         prop_true_high_cos_sim flash_…      0.8  
 7 group_overlap    &lt;NA&gt;               prop_true_high_cos_sim flash_…      0.64 
 8 group_overlap    &lt;NA&gt;               prop_true_high_cos_sim flash_…      0.56 
 9 unbaltree_4pop   rep(40, 4)         prop_true_high_cos_sim flash_…      0.571
10 unbaltree_4pop   rep(40, 4)         prop_true_high_cos_sim flash_…      0.557</code></pre>
<p>With regards to the proportion of true factors recovered, we again
see that flash with a normal prior on <span
class="math inline">\(F\)</span> has the same or better performance than
flash with a point-Laplace prior on <span
class="math inline">\(F\)</span>.</p>
<pre class="r"><code>dscout %&gt;% filter(score == &#39;prop_est_high_cos_sim&#39;, score.threshold == 0.99, analyze.Kmax_factor == 2) %&gt;% group_by(simulate, simulate.pop_sizes, score, analyze) %&gt;% summarise(avg_result = mean(score.result)) %&gt;% arrange(simulate, simulate.pop_sizes, score, analyze)</code></pre>
<pre><code>`summarise()` has grouped output by &#39;simulate&#39;, &#39;simulate.pop_sizes&#39;, &#39;score&#39;.
You can override using the `.groups` argument.</code></pre>
<pre><code># A tibble: 10 × 5
# Groups:   simulate, simulate.pop_sizes, score [5]
   simulate         simulate.pop_sizes score                 analyze  avg_result
   &lt;chr&gt;            &lt;chr&gt;              &lt;chr&gt;                 &lt;chr&gt;         &lt;dbl&gt;
 1 baltree_4pop     rep(40, 4)         prop_est_high_cos_sim flash_n…      0.878
 2 baltree_4pop     rep(40, 4)         prop_est_high_cos_sim flash_s…      0.46 
 3 group_nonoverlap c(20,50,30,60)     prop_est_high_cos_sim flash_n…      0.454
 4 group_nonoverlap c(20,50,30,60)     prop_est_high_cos_sim flash_s…      0.855
 5 group_nonoverlap rep(40, 4)         prop_est_high_cos_sim flash_n…      0.4  
 6 group_nonoverlap rep(40, 4)         prop_est_high_cos_sim flash_s…      0.8  
 7 group_overlap    &lt;NA&gt;               prop_est_high_cos_sim flash_n…      0.361
 8 group_overlap    &lt;NA&gt;               prop_est_high_cos_sim flash_s…      0.525
 9 unbaltree_4pop   rep(40, 4)         prop_est_high_cos_sim flash_n…      0.925
10 unbaltree_4pop   rep(40, 4)         prop_est_high_cos_sim flash_s…      0.84 </code></pre>
<p>For the tree settings, flash with normal prior on <span
class="math inline">\(F\)</span> has a higher proportion; perhaps this
method does a better job at recovering some of the components of the
tree. For the other settings, flash with point-Laplace prior on <span
class="math inline">\(F\)</span> has a higher proportion, suggesting it
is better at avoiding extra or redundant factors.</p>
</div>
</div>
<div id="visualizations-for-correct-k-input" class="section level1">
<h1>Visualizations for correct K input</h1>
<p>In this section, we visualize an example of estimates from
flash-semiNMF. For these estimates, the method was given the correct
number of components.</p>
<pre class="r"><code>data_files &lt;- list.files(path = &#39;data/flash_seminmf_dsc_ex&#39;)</code></pre>
<p>These are heatmaps of the estimated loadings:</p>
<pre class="r"><code>for (i in data_files){
  #extract method
  setting &lt;- sub(&quot;^([^_]*_[^_]*).*&quot;, &quot;\\1&quot;, i)
  
  est &lt;- readRDS(paste0(&#39;data/flash_seminmf_dsc_ex/&#39;,i))$est_L
  plot_heatmap(est, title = setting, 
               colors_range = c(&#39;blue&#39;,&#39;gray96&#39;,&#39;red&#39;),
               brks = seq(-max(abs(est)), max(abs(est)), length.out = 50))
}</code></pre>
<p><img src="figure/flash_seminmf_analysis.Rmd/unnamed-chunk-12-1.png" width="672" style="display: block; margin: auto;" /><img src="figure/flash_seminmf_analysis.Rmd/unnamed-chunk-12-2.png" width="672" style="display: block; margin: auto;" /><img src="figure/flash_seminmf_analysis.Rmd/unnamed-chunk-12-3.png" width="672" style="display: block; margin: auto;" /><img src="figure/flash_seminmf_analysis.Rmd/unnamed-chunk-12-4.png" width="672" style="display: block; margin: auto;" /><img src="figure/flash_seminmf_analysis.Rmd/unnamed-chunk-12-5.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="visualizations-for-larger-k-input" class="section level1">
<h1>Visualizations for larger K input</h1>
<p>In this section, we visualize another set of estimates – for these
estimates, the method was given double the correct number of
components.</p>
<pre class="r"><code>data_files_2k &lt;- list.files(path = &#39;data/flash_seminmf_dsc_2k_ex&#39;)</code></pre>
<p>These are heatmaps of the estimated loadings:</p>
<pre class="r"><code>for (i in data_files_2k){
  #extract method
  setting &lt;- sub(&quot;^([^_]*_[^_]*).*&quot;, &quot;\\1&quot;, i)
  
  est &lt;- readRDS(paste0(&#39;data/flash_seminmf_dsc_2k_ex/&#39;,i))$est_L
  plot_heatmap(est, title = setting, 
               colors_range = c(&#39;blue&#39;,&#39;gray96&#39;,&#39;red&#39;),
               brks = seq(-max(abs(est)), max(abs(est)), length.out = 50))
}</code></pre>
<p><img src="figure/flash_seminmf_analysis.Rmd/unnamed-chunk-14-1.png" width="672" style="display: block; margin: auto;" /><img src="figure/flash_seminmf_analysis.Rmd/unnamed-chunk-14-2.png" width="672" style="display: block; margin: auto;" /><img src="figure/flash_seminmf_analysis.Rmd/unnamed-chunk-14-3.png" width="672" style="display: block; margin: auto;" /><img src="figure/flash_seminmf_analysis.Rmd/unnamed-chunk-14-4.png" width="672" style="display: block; margin: auto;" /><img src="figure/flash_seminmf_analysis.Rmd/unnamed-chunk-14-5.png" width="672" style="display: block; margin: auto;" /></p>
<br>
<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-sessioninfo" data-toggle="collapse" data-target="#workflowr-sessioninfo" style="display: block;">
<span class="glyphicon glyphicon-wrench" aria-hidden="true"></span>
Session information
</button>
</p>
<div id="workflowr-sessioninfo" class="collapse">
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>R version 4.3.2 (2023-10-31)
Platform: aarch64-apple-darwin20 (64-bit)
Running under: macOS 15.6

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRblas.0.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: America/Chicago
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] pheatmap_1.0.12 ggplot2_3.5.2   dplyr_1.1.4     workflowr_1.7.1

loaded via a namespace (and not attached):
 [1] softImpute_1.4-3     gtable_0.3.6         flashier_1.0.56     
 [4] xfun_0.52            bslib_0.9.0          htmlwidgets_1.6.4   
 [7] processx_3.8.4       ggrepel_0.9.6        ebnm_1.1-34         
[10] lattice_0.22-6       callr_3.7.6          quadprog_1.5-8      
[13] vctrs_0.6.5          tools_4.3.2          ps_1.7.7            
[16] generics_0.1.4       parallel_4.3.2       Polychrome_1.5.1    
[19] tibble_3.3.0         pkgconfig_2.0.3      Matrix_1.6-5        
[22] data.table_1.17.6    SQUAREM_2021.1       RColorBrewer_1.1-3  
[25] RcppParallel_5.1.10  scatterplot3d_0.3-44 lifecycle_1.0.4     
[28] truncnorm_1.0-9      compiler_4.3.2       farver_2.1.2        
[31] stringr_1.5.1        git2r_0.33.0         progress_1.2.3      
[34] RhpcBLASctl_0.23-42  getPass_0.2-4        httpuv_1.6.15       
[37] htmltools_0.5.8.1    sass_0.4.10          lazyeval_0.2.2      
[40] yaml_2.3.10          plotly_4.11.0        crayon_1.5.3        
[43] tidyr_1.3.1          later_1.4.2          pillar_1.10.2       
[46] jquerylib_0.1.4      whisker_0.4.1        uwot_0.2.3          
[49] cachem_1.1.0         trust_0.1-8          gtools_3.9.5        
[52] tidyselect_1.2.1     digest_0.6.37        Rtsne_0.17          
[55] stringi_1.8.7        purrr_1.0.4          ashr_2.2-66         
[58] splines_4.3.2        cowplot_1.1.3        rprojroot_2.0.4     
[61] fastmap_1.2.0        grid_4.3.2           colorspace_2.1-1    
[64] cli_3.6.5            invgamma_1.1         magrittr_2.0.3      
[67] utf8_1.2.6           withr_3.0.2          prettyunits_1.2.0   
[70] scales_1.4.0         promises_1.3.3       horseshoe_0.2.0     
[73] rmarkdown_2.29       httr_1.4.7           fastTopics_0.6-192  
[76] deconvolveR_1.2-1    hms_1.1.3            pbapply_1.7-2       
[79] evaluate_1.0.4       knitr_1.50           viridisLite_0.4.2   
[82] irlba_2.3.5.1        rlang_1.1.6          Rcpp_1.0.14         
[85] mixsqp_0.3-54        glue_1.8.0           rstudioapi_0.16.0   
[88] jsonlite_2.0.0       R6_2.6.1             fs_1.6.6            </code></pre>
</div>
</div>


<!-- Adjust MathJax settings so that all math formulae are shown using
TeX fonts only; see
https://docs.mathjax.org/en/latest/web/configuration.html. This will make
the presentation more consistent at the cost of the webpage sometimes
taking slightly longer to load. Note that this only works because the
footer is added to webpages before the MathJax javascript. -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    "HTML-CSS": { availableFonts: ["TeX"] }
  });
</script>




</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
